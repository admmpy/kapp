# Kapp LLM Integration - Architecture Diagram

## System Overview

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                         USER DEVICE (MacBook)                        โ
โ                                                                      โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ  โ                   FRONTEND (React/TS)                        โ   โ
โ  โ                   Port: 5173 (Vite)                          โ   โ
โ  โ                                                              โ   โ
โ  โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ    โ   โ
โ  โ  โ         EXISTING COMPONENTS                        โ    โ   โ
โ  โ  โ                                                    โ    โ   โ
โ  โ  โ  โข Dashboard.tsx                                  โ    โ   โ
โ  โ  โ  โข ReviewSession.tsx                              โ    โ   โ
โ  โ  โ  โข FlashCard.tsx โ (Add "Explain" button)       โ    โ   โ
โ  โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ    โ   โ
โ  โ                          โ                                   โ   โ
โ  โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ    โ   โ
โ  โ  โ         NEW LLM COMPONENTS                         โ    โ   โ
โ  โ  โ                                                    โ    โ   โ
โ  โ  โ  โข ExplanationModal.tsx (NEW)                    โ    โ   โ
โ  โ  โ  โข ConversationMode.tsx (Phase 2)                โ    โ   โ
โ  โ  โ  โข api/llm.ts (NEW API client)                   โ    โ   โ
โ  โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ    โ   โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ                         โ HTTP Requests                             โ
โ                         โ                                            โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ  โ                   BACKEND (Flask/Python)                     โ   โ
โ  โ                   Port: 5001                                 โ   โ
โ  โ                                                              โ   โ
โ  โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ    โ   โ
โ  โ  โ         EXISTING ROUTES                            โ    โ   โ
โ  โ  โ                                                    โ    โ   โ
โ  โ  โ  โข /api/cards        (flashcard data)            โ    โ   โ
โ  โ  โ  โข /api/reviews      (submit ratings)            โ    โ   โ
โ  โ  โ  โข /api/stats        (dashboard stats)           โ    โ   โ
โ  โ  โ  โข /api/audio        (TTS audio files)           โ    โ   โ
โ  โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ    โ   โ
โ  โ                          โ                                   โ   โ
โ  โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ    โ   โ
โ  โ  โ         NEW LLM ROUTES (routes/llm.py)             โ    โ   โ
โ  โ  โ                                                    โ    โ   โ
โ  โ  โ  โข POST /api/llm/explain           (Phase 1)     โ    โ   โ
โ  โ  โ  โข POST /api/llm/generate-examples (Phase 1)     โ    โ   โ
โ  โ  โ  โข POST /api/llm/conversation      (Phase 2)     โ    โ   โ
โ  โ  โ  โข GET  /api/llm/health            (Phase 1)     โ    โ   โ
โ  โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ    โ   โ
โ  โ                          โ                                   โ   โ
โ  โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ    โ   โ
โ  โ  โ         LLM SERVICE (llm_service.py)               โ    โ   โ
โ  โ  โ                                                    โ    โ   โ
โ  โ  โ  OllamaClient:                                    โ    โ   โ
โ  โ  โ  โข build_prompt()                                 โ    โ   โ
โ  โ  โ  โข check_cache()                                  โ    โ   โ
โ  โ  โ  โข call_ollama()                                  โ    โ   โ
โ  โ  โ  โข parse_response()                               โ    โ   โ
โ  โ  โ  โข cache_result()                                 โ    โ   โ
โ  โ  โ                                                    โ    โ   โ
โ  โ  โ  Prompt Templates:                                โ    โ   โ
โ  โ  โ  โข EXPLAIN_CARD                                   โ    โ   โ
โ  โ  โ  โข GENERATE_EXAMPLES                              โ    โ   โ
โ  โ  โ  โข CONVERSATION                                   โ    โ   โ
โ  โ  โโโโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ    โ   โ
โ  โ                         โ                                    โ   โ
โ  โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ    โ   โ
โ  โ  โ         RESPONSE CACHE (File-based)                โ    โ   โ
โ  โ  โ         backend/data/llm_cache/                    โ    โ   โ
โ  โ  โ                                                    โ    โ   โ
โ  โ  โ  โข {hash1}.json  (cached explanation)            โ    โ   โ
โ  โ  โ  โข {hash2}.json  (cached examples)               โ    โ   โ
โ  โ  โ  โข ...                                           โ    โ   โ
โ  โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ    โ   โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ                         โ HTTP POST                                 โ
โ                         โ                                            โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ  โ                   OLLAMA SERVER                              โ   โ
โ  โ                   Port: 11434                                โ   โ
โ  โ                                                              โ   โ
โ  โ  โข Model Manager                                            โ   โ
โ  โ  โข OpenAI-compatible API                                    โ   โ
โ  โ  โข GPU/CPU inference engine                                 โ   โ
โ  โ                                                              โ   โ
โ  โ  Loaded Model:                                              โ   โ
โ  โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ     โ   โ
โ  โ  โ    Qwen 2.5 7B (4.1GB)                            โ     โ   โ
โ  โ  โ    โข 7 billion parameters                          โ     โ   โ
โ  โ  โ    โข Strong Korean/Chinese/English support        โ     โ   โ
โ  โ  โ    โข Loaded in RAM: ~7-8GB                        โ     โ   โ
โ  โ  โ    โข Inference: 1-3s per request                  โ     โ   โ
โ  โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ     โ   โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ                                                                      โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ  โ              EXISTING DATABASE (SQLite)                      โ   โ
โ  โ              backend/data/kapp.db                            โ   โ
โ  โ                                                              โ   โ
โ  โ  โข Card table (flashcards)                                  โ   โ
โ  โ  โข Review table (user ratings)                              โ   โ
โ  โ  โข Deck table (card collections)                            โ   โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## Data Flow: "Explain This Card"

### Step-by-Step Process

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ STEP 1: User Action                                                 โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
    User clicks "๐ก Explain This" button on flashcard
    โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ STEP 2: Frontend Request                                            โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
    ExplanationModal.tsx
    โ
    llmClient.explainCard(card_id, userContext)
    โ
    POST http://localhost:5001/api/llm/explain
    {
      "card_id": 123,
      "user_context": {
        "level": 1,
        "time_spent": 45
      }
    }
    โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ STEP 3: Backend Route Handler                                       โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
    routes/llm.py โ @llm_bp.route('/llm/explain')
    โ
    Validate request
    โ
    Fetch card from database:
    SELECT * FROM card WHERE id = 123
    โ
    Result: {
      front_korean: "์๋ํ์ธ์",
      back_english: "Hello (formal)",
      level: 0
    }
    โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ STEP 4: LLM Service - Build Prompt                                  โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
    llm_service.py โ OllamaClient.chat()
    โ
    Load template: PROMPT_TEMPLATES['explain_card']
    โ
    Build System Prompt:
    """
    You are an expert Korean language tutor helping English speakers.
    Your explanations are clear, concise, and appropriate for the 
    learner's level.
    ...
    """
    โ
    Build User Prompt:
    """
    Explain this Korean vocabulary:
    
    Korean: ์๋ํ์ธ์
    Romanisation: annyeonghaseyo
    English: Hello (formal)
    Learner Level: Absolute Beginner (TOPIK Level 0)
    
    Please provide:
    1. A clear explanation of the meaning and usage
    2. 2-3 example sentences showing different contexts
    3. Common mistakes learners make with this word
    4. Any important grammar or cultural notes
    
    Keep your response concise (under 200 words) and beginner-friendly.
    """
    โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ STEP 5: Check Cache                                                 โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
    Generate cache key:
    MD5("system_prompt|user_prompt|qwen2.5:7b")
    โ "a3f2b1c4d5e6f7g8h9i0j1k2l3m4n5o6"
    โ
    Check file: backend/data/llm_cache/a3f2b1c4...json
    โ
    IF EXISTS and < 24 hours old:
      โ
      Read cached response
      โ
      SKIP TO STEP 8 โจ (FAST!)
    โ
    IF NOT EXISTS or expired:
      โ
      Continue to STEP 6
    โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ STEP 6: Call Ollama API                                             โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
    POST http://localhost:11434/v1/chat/completions
    {
      "model": "qwen2.5:7b",
      "messages": [
        {"role": "system", "content": "..."},
        {"role": "user", "content": "..."}
      ],
      "temperature": 0.7,
      "max_tokens": 500
    }
    โ
    [Ollama processes with local Qwen model]
    [Takes 1-3 seconds on GPU, 3-5s on CPU]
    โ
    Response:
    {
      "choices": [{
        "message": {
          "content": "์๋ํ์ธ์ (annyeonghaseyo) is the most common..."
        }
      }]
    }
    โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ STEP 7: Cache Response                                              โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
    Write to: backend/data/llm_cache/a3f2b1c4...json
    {
      "response": "์๋ํ์ธ์ (annyeonghaseyo) is...",
      "timestamp": "2025-11-06T10:30:00Z",
      "model": "qwen2.5:7b"
    }
    โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ STEP 8: Return to Frontend                                          โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
    Flask response:
    {
      "explanation": "์๋ํ์ธ์ (annyeonghaseyo) is the most common...",
      "card_id": 123,
      "generated_at": "2025-11-06T10:30:00Z"
    }
    โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ STEP 9: Display in UI                                               โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
    ExplanationModal.tsx renders:
    
    โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
    โ  ๐ก Explanation                      [ร]    โ
    โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
    โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
    โ  โ        ์๋ํ์ธ์                      โ  โ
    โ  โ     Hello (formal)                    โ  โ
    โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
    โ                                             โ
    โ  ์๋ํ์ธ์ (annyeonghaseyo) is the most    โ
    โ  common and polite way to greet someone    โ
    โ  in Korean...                              โ
    โ                                             โ
    โ  [Full explanation displayed here]         โ
    โ                                             โ
    โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
    โ                              [ Got It! ]   โ
    โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
    โ
    User reads explanation and closes modal
```

---

## Performance Optimisation Flow

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                    REQUEST ARRIVES                             โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                              โ
                    โโโโโโโโโโโโโโโโโโโ
                    โ  Check Cache?   โ
                    โโโโโโโโโโโโโโโโโโโ
                       โ           โ
                    YES           NO
                      โ             โ
        โโโโโโโโโโโโโโโโโโโโ   โโโโโโโโโโโโโโโโโโโโ
        โ  Read from File  โ   โ  Call Ollama     โ
        โ  <100ms โก       โ   โ  1-5s ๐         โ
        โโโโโโโโโโโโโโโโโโโโ   โโโโโโโโโโโโโโโโโโโโ
                      โ             โ
                      โโโโโโโฌโโโโโโโโ
                            โ
                    โโโโโโโโโโโโโโโโโโโ
                    โ  Return Result  โ
                    โโโโโโโโโโโโโโโโโโโ

Cache Hit Rate: ~60-70% in normal use
Typical Savings: 2-4 seconds per cached request
Cache Lifetime: 24 hours (configurable)
```

---

## Error Handling Flow

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                    EXPLANATION REQUEST                         โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                              โ
                    โโโโโโโโโโโโโโโโโโโ
                    โ  Try Ollama     โ
                    โ  LLM Call       โ
                    โโโโโโโโโโโโโโโโโโโ
                              โ
                    โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                    โ  Success?                   โ
                    โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                       โ                     โ
                    YES                     NO
                      โ                      โ
        โโโโโโโโโโโโโโโโโโโโโโโโ   โโโโโโโโโโโโโโโโโโโโโโโโ
        โ  Return AI Response  โ   โ  What Error?         โ
        โ  โ                  โ   โโโโโโโโโโโโโโโโโโโโโโโโ
        โโโโโโโโโโโโโโโโโโโโโโโโ            โ
                                   โโโโโโโโโโดโโโโโโโโโ
                                   โ                 โ
                    โโโโโโโโโโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโโโโโโโโโ
                    โ  Timeout (>30s)     โ  โ  Connection Refused  โ
                    โ                     โ  โ  (Ollama not running)โ
                    โโโโโโโโโโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโโโโโโโโโ
                              โ                         โ
                    โโโโโโโโโโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโโโโโโโโโ
                    โ  Return Error:       โ  โ  Return Error:       โ
                    โ  "Request timed out" โ  โ  "LLM unavailable"   โ
                    โ  โฑ๏ธ                  โ  โ  โ๏ธ                  โ
                    โโโโโโโโโโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโโโโโโโโโ
                              โ                         โ
                    โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                    โ  Frontend Shows Error UI with Retry Button  โ
                    โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## Comparison: Traditional vs LLM-Enhanced Review

### Traditional Flow (Current)
```
User sees card "์๋ํ์ธ์"
    โ
Clicks "Show Answer"
    โ
Sees: "Hello (formal)"
    โ
Rates understanding (0-5)
    โ
Next card
    
Time: ~5 seconds per card
Learning: Basic recognition only
```

### LLM-Enhanced Flow (After Implementation)
```
User sees card "์๋ํ์ธ์"
    โ
Clicks "Show Answer"
    โ
Sees: "Hello (formal)"
    โ
IF confused: Clicks "๐ก Explain This"
    โ
Reads AI explanation:
  โข Usage contexts
  โข Example sentences
  โข Common mistakes
  โข Cultural notes
    โ
Rates understanding (0-5)
    โ
Next card
    
Time: ~10-15 seconds per confusing card
Learning: Deep understanding with context
Retention: Significantly improved
```

---

## Resource Usage Timeline

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                    APPLICATION STARTUP                              โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

T = 0s
  Frontend starts (Vite dev server)
  Backend starts (Flask)
  Memory: ~200MB

T = 1s  
  User navigates to review session
  
T = 2s
  First card loads from database
  
T = 5s
  User clicks "Explain This" (first time)
  
T = 5.5s
  Backend receives request
  Ollama hasn't been called yet
  
T = 6s
  First call to Ollama
  [IF MODEL NOT LOADED]
    โ Ollama loads Qwen 2.5 7B into RAM
    โ Takes 5-10 seconds
    โ Memory spikes to +7GB
  
T = 16s
  Model loaded, inference begins
  GPU/CPU works on generation
  
T = 18s
  Response complete (2s inference)
  Explanation returned to frontend
  
T = 20s
  User reads explanation
  
T = 45s
  User clicks "Explain This" on second card
  
T = 45.5s
  [MODEL ALREADY LOADED โ]
  Inference begins immediately
  
T = 47.5s
  Response complete (2s inference)
  Much faster!
  
T = 60s
  User clicks "Explain This" on previously explained card
  
T = 60.1s
  [CACHE HIT โ]
  Response instant (<100ms)
  Ultra fast!

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                    STEADY STATE                                     โ
โ                                                                     โ
โ  โข Model: Loaded in RAM (7-8GB)                                    โ
โ  โข Cache: Growing (50-200MB typical)                               โ
โ  โข Response times: 1-3s (GPU) or 3-5s (CPU)                       โ
โ  โข Cached responses: <100ms                                        โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## Security & Privacy Model

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                    YOUR COMPUTER (LOCAL)                            โ
โ                                                                     โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ  โ  FRONTEND                                                     โ โ
โ  โ  โข Korean text                                                โ โ
โ  โ  โข User input                                                 โ โ
โ  โ  โข Learning history                                           โ โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ                              โ                                      โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ  โ  BACKEND                                                      โ โ
โ  โ  โข Flask routes                                               โ โ
โ  โ  โข Database (SQLite)                                          โ โ
โ  โ  โข LLM service                                                โ โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ                              โ                                      โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ  โ  OLLAMA                                                       โ โ
โ  โ  โข Qwen 2.5 7B model                                          โ โ
โ  โ  โข Inference engine                                           โ โ
โ  โ  โข Response generation                                        โ โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ                                                                     โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ  โ  FILE SYSTEM                                                  โ โ
โ  โ  โข Database: data/kapp.db                                     โ โ
โ  โ  โข LLM Cache: data/llm_cache/                                 โ โ
โ  โ  โข Model Weights: ~/.ollama/models/                           โ โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ                                                                     โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                              โ
                    โโโโโโโโโโโโโโโโโโโ
                    โ   NO INTERNET   โ
                    โ   CONNECTION    โ
                    โ   REQUIRED!     โ
                    โโโโโโโโโโโโโโโโโโโ

Compare to Duolingo (OpenAI API):

YOUR COMPUTER  โ  INTERNET  โ  OPENAI SERVERS  โ  INTERNET  โ  RESPONSE
   ๐               ๐            ๐ (data exposed)    ๐         ๐
```

---

## Future Architecture (Phase 2+)

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                    KAPP v2.0 (Future Vision)                         โ
โ                                                                      โ
โ  Frontend (React)                                                    โ
โ  โโ Dashboard                                                        โ
โ  โโ ReviewSession                                                    โ
โ  โโ FlashCard                                                        โ
โ  โโ ExplanationModal         โ Phase 1 โ                           โ
โ  โโ ConversationMode         โ Phase 2 ๐ฌ                           โ
โ  โโ SmartHints              โ Phase 2 ๐ก                           โ
โ  โโ DynamicQuiz             โ Phase 3 ๐ฎ                           โ
โ  โโ LearningAnalytics       โ Phase 3 ๐                           โ
โ                                                                      โ
โ  Backend (Flask)                                                     โ
โ  โโ /api/cards              โ Existing                              โ
โ  โโ /api/reviews            โ Existing                              โ
โ  โโ /api/stats              โ Existing                              โ
โ  โโ /api/audio              โ Existing (TTS)                        โ
โ  โโ /api/llm/explain        โ Phase 1 โ                           โ
โ  โโ /api/llm/examples       โ Phase 1 โ                           โ
โ  โโ /api/llm/conversation   โ Phase 2 ๐ฌ                           โ
โ  โโ /api/llm/hints          โ Phase 2 ๐ก                           โ
โ  โโ /api/llm/quiz           โ Phase 3 ๐ฎ                           โ
โ  โโ /api/llm/path           โ Phase 3 ๐ฏ                           โ
โ  โโ /api/llm/culture        โ Phase 3 ๐                           โ
โ                                                                      โ
โ  LLM Stack                                                           โ
โ  โโ Ollama (inference)                                              โ
โ  โโ Qwen 2.5 7B (main model)                                        โ
โ  โโ Llama 3.1 8B (fallback)                                         โ
โ  โโ Custom fine-tuned model (future)                                โ
โ                                                                      โ
โ  Storage                                                             โ
โ  โโ SQLite (cards, reviews, users)                                  โ
โ  โโ File cache (LLM responses)                                      โ
โ  โโ File cache (TTS audio)                                          โ
โ  โโ Session storage (conversations)                                 โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## Summary

This architecture provides:

โ **Local-first**: Everything runs on your computer
โ **Fast**: 2-5s responses, <100ms when cached
โ **Private**: No data leaves your machine
โ **Scalable**: Can add more features easily
โ **Maintainable**: Clear separation of concerns
โ **Cost-effective**: Free forever
โ **Offline-capable**: Works without internet

The modular design allows you to:
- Start with basic explanation feature (Phase 1)
- Add conversation mode later (Phase 2)
- Extend with advanced features (Phase 3+)

Each phase builds on the previous foundation without breaking existing functionality.

---

**Ready to implement?** Start with Phase 1 in `LLM_INTEGRATION_PLAN.md`! ๐

